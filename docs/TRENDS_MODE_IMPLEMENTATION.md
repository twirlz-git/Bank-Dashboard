# Trends Mode Implementation Guide

## Обзор

Реализация **Trends Mode** для анализа исторических изменений банковских продуктов через **Search-based Timeline Reconstruction**.

## Ключевые особенности

### 1. Поиск по новостям вместо БД

✅ **Преимущества:**
- Нет необходимости накапливать исторические данные
- Можно анализировать историю "на лету"
- Источники данных: banki.ru/news, sravni.ru, kommersant.ru

### 2. LLM-извлечение временных рядов

✅ **Возможности:**
- Извлечение даты, значения, причины изменения
- Оценка достоверности (confidence score)
- Fallback на regex-извлечение при отсутствии LLM

### 3. Комплексный анализ

✅ **Метрики:**
- Начальное/конечное значение
- Минимум/максимум/среднее
- Общее изменение и процент изменения
- Количество точек изменения
- Определение тренда (рост/падение/стабильность)

## Архитектура

```
Аналитик: "Покажи изменения ставки ВТБ за 3 месяца"
                    ↓
        TrendsAnalyzer.analyze_trends()
                    ↓
        ┌────────────────────────┐
        │ 1. Расчет дат        │
        │    start_date, end_date  │
        └─────────────┬───────────┘
                    ↓
        ┌─────────────┬─────────────┐
        │ 2. Web Search       │
        │    • Формирование   │
        │      запроса          │
        │    • Поиск по       │
        │      новостям        │
        │    • Сбор снипетов │
        └─────────────┬─────────────┘
                    ↓
        ┌─────────────┬─────────────┐
        │ 3. LLM Extraction   │
        │    • Извлечение   │
        │      даты             │
        │    • Извлечение   │
        │      значения          │
        │    • Определение   │
        │      причины          │
        └─────────────┬─────────────┘
                    ↓
        ┌─────────────┬─────────────┐
        │ 4. Timeline Build   │
        │    • Сортировка    │
        │    • Интерполяция │
        │    • Заполнение   │
        │      пропусков        │
        └─────────────┬─────────────┘
                    ↓
        ┌─────────────┬─────────────┐
        │ 5. Analysis         │
        │    • Статистика    │
        │    • Тренд           │
        │    • Выводы         │
        └─────────────┬─────────────┘
                    ↓
        ┌─────────────┬─────────────┐
        │ 6. Генерация отчета │
        │    • Summary         │
        │    • Timeline table  │
        │    • Charts          │
        │    • XLSX export     │
        └─────────────┬─────────────┘
                    ↓
        Аналитик получает отчет ✓
```

## Пример использования

### Базовое использование

```python
from modules.trends_analyzer import TrendsAnalyzer

# Инициализация
analyzer = TrendsAnalyzer()

# Анализ за 3 месяца
results = analyzer.analyze_trends(
    bank="ВТБ",
    product_type="credit_card",
    time_period="last_3_months",
    use_real_search=False  # True для реального поиска
)

print(results["summary"])
```

## Статус

✅ **Готово к MVP**
- Базовая функциональность реализована
- LLM-извлечение работает
- Fallback стратегия есть
- Анализ и статистика реализованы

🔧 **Требуется для production**
- Реальный web scraping
- Интерполяция временных рядов
- Графики и визуализация
- Кэширование
- Тесты
